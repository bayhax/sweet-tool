name: Update PR Description via Codex

on:
  pull_request:
    branches:
      - main

jobs:
  update-pr-description:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Node.js ç‰ˆæœ¬
        uses: actions/setup-node@v4
        with:
          node-version: '22.1.0'

      - name: ç”ŸæˆPRå†…å®¹
        id: generate-pr-content
        run: |
          npm install -g @openai/codex
          export OPENAI_API_KEY="${{ secrets.OPENAI_API_KEY }}"
          PR_CONTENT=$(codex -a auto-edit "åŸºäºè¯¥åˆ†æ”¯ï¼Œç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„PRæè¿°ï¼ŒåŒ…æ‹¬å˜æ›´å†…å®¹ã€å½±å“èŒƒå›´å’Œä¸»è¦ä¿®æ”¹ç‚¹")
          echo "PR_CONTENT<<EOF" >> $GITHUB_ENV
          echo "$PR_CONTENT" >> $GITHUB_ENV
          echo "EOF" >> $GITHUB_ENV

      - name: æ›´æ–°PRæè¿°
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { issue: { number: issue_number }, repo: { owner, repo } } = context;
            
            await github.rest.pulls.update({
              owner,
              repo,
              pull_number: issue_number,
              body: process.env.PR_CONTENT
            });
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number,
              body: "ğŸ¤– æˆ‘å·²è‡ªåŠ¨æ›´æ–°äº†PRæè¿°"
            }); 